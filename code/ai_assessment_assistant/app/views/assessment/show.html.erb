<div class="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <!-- Glassmorphism Card -->
    <div class="backdrop-blur-md bg-white/10 rounded-3xl border border-white/20 shadow-2xl p-8 text-center">
      
      <!-- LaunchPad Lab Logo -->
      <div class="mb-8">
        <%= image_tag "Blue-Horizontal-LPL-Logo.svg", 
            alt: "LaunchPad Lab",
            class: "h-8 mx-auto filter brightness-0 invert" %>
      </div>
      
      <!-- Company Information -->
      <div class="mb-8">
        <h1 class="text-2xl font-bold text-white mb-2">AI Assessment</h1>
        <h2 class="text-lg text-blue-200 mb-4"><%= @company.name %></h2>
        
        <div class="text-sm text-gray-300 space-y-2">
          <p>Welcome! You've been invited to participate in an AI readiness assessment.</p>
          <p>This conversation will take approximately 15-20 minutes.</p>
        </div>
      </div>
      
      <!-- Company Context -->
      <% if @company.custom_instructions.present? %>
        <div class="mb-8 p-4 rounded-2xl bg-white/5 border border-white/10">
          <h3 class="text-sm font-semibold text-blue-200 mb-2">Assessment Context</h3>
          <p class="text-xs text-gray-300 leading-relaxed">
            <%= truncate(@company.custom_instructions, length: 150) %>
          </p>
        </div>
      <% end %>
      
      <!-- Start Assessment Button -->
      <div class="space-y-4">
        <%= form_with url: start_assessment_path(@stakeholder.invitation_token), 
            method: :post, 
            local: true,
            id: "assessmentForm",
            class: "space-y-4" do |form| %>
          
          <button type="button" id="beginAssessmentBtn" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 
                     text-white font-semibold py-4 px-6 rounded-2xl shadow-lg 
                     transform hover:-translate-y-1 transition-all duration-200
                     focus:outline-none focus:ring-4 focus:ring-blue-500/50">
            <span id="btnText">Begin Assessment</span>
            <span id="loadingSpinner" class="hidden">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Requesting microphone access...
            </span>
          </button>
        <% end %>
        
        <p class="text-xs text-gray-400" id="statusMessage">
          By proceeding, you agree to participate in this assessment interview.
        </p>
      </div>
      
    </div>
    
    <!-- Footer -->
    <div class="text-center mt-6">
      <p class="text-xs text-gray-400">
        Â© 2025 LaunchPad Lab. AI Assessment Assistant
      </p>
    </div>
  </div>
</div>

<!-- JavaScript for Microphone Access -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const beginBtn = document.getElementById('beginAssessmentBtn');
  const btnText = document.getElementById('btnText');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const statusMessage = document.getElementById('statusMessage');
  const assessmentForm = document.getElementById('assessmentForm');
  
  beginBtn.addEventListener('click', async function() {
    try {
      // Update button to show loading state
      btnText.classList.add('hidden');
      loadingSpinner.classList.remove('hidden');
      beginBtn.disabled = true;
      statusMessage.textContent = 'Please allow microphone access when prompted...';
      statusMessage.className = 'text-xs text-blue-300';
      
      // Request microphone access
      console.log('ðŸŽ¤ Requesting microphone access...');
      const stream = await navigator.mediaDevices.getUserMedia({ 
        audio: {
          sampleRate: 24000,
          channelCount: 1,
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        } 
      });
      
      console.log('âœ… Microphone access granted!');
      
      // Clean up the stream (we just needed permission)
      stream.getTracks().forEach(track => track.stop());
      
      // Update UI to show success
      loadingSpinner.classList.add('hidden');
      btnText.textContent = 'Starting Assessment...';
      btnText.classList.remove('hidden');
      statusMessage.textContent = 'Microphone access granted! Starting your assessment...';
      statusMessage.className = 'text-xs text-green-300';
      
      // Small delay for user feedback, then submit form
      setTimeout(() => {
        assessmentForm.submit();
      }, 1000);
      
    } catch (error) {
      console.error('Microphone access denied or failed:', error);
      
      // Reset button state
      btnText.classList.remove('hidden');
      loadingSpinner.classList.add('hidden');
      beginBtn.disabled = false;
      
      // Show error message
      statusMessage.textContent = 'Microphone access is required for the voice assessment. Please allow access and try again.';
      statusMessage.className = 'text-xs text-red-300';
      
      // Change button text to retry
      btnText.textContent = 'Try Again - Allow Microphone';
    }
  });
});
</script> 